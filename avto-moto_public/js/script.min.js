"use strict";

function testWebP(e) {
  var t = new Image();
  t.onload = t.onerror = function () {
    e(2 == t.height);
  }, t.src = "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";
}

testWebP(function (e) {
  1 == e ? document.querySelector("body").classList.add("webp") : document.querySelector("body").classList.add("no-webp");
});
var allSlides = document.querySelectorAll(".slider__item"),
    leftBtn = document.querySelector(".slider__btn-left"),
    rightBtn = document.querySelector(".slider__btn-right"),
    allMiniPictures = document.querySelectorAll(".slider__mini-pic");
leftBtn.addEventListener("click", function () {
  moveSlideFromBtn(-1);
}), rightBtn.addEventListener("click", function () {
  moveSlideFromBtn(1);
});

var _loop = function _loop(e) {
  allMiniPictures[e].addEventListener("click", function () {
    moveSlideFromPic(e);
  });
};

for (var e = 0; e < allMiniPictures.length; e++) {
  _loop(e);
}

function moveSlideFromBtn(e) {
  var t = findCurrentSlide();
  (t < 3 && 1 == e || t > 0 && -1 == e) && (t += e), checkAvailabilityButtons(t), displayRightSlide(t);
}

function moveSlideFromPic(e) {
  checkAvailabilityButtons(e), displayRightSlide(e);
}

function findCurrentSlide() {
  for (var _e = 0; _e < allSlides.length; _e++) {
    if (!allSlides[_e].classList.contains("slider__item-opacity")) return _e;
  }
}

function checkAvailabilityButtons(e) {
  0 == e ? (leftBtn.setAttribute("disabled", ""), rightBtn.removeAttribute("disabled", "")) : e == allSlides.length - 1 ? (leftBtn.removeAttribute("disabled", ""), rightBtn.setAttribute("disabled", "")) : (leftBtn.removeAttribute("disabled", ""), rightBtn.removeAttribute("disabled", ""));
}

function displayRightSlide(e) {
  for (var t = 0; t < allSlides.length; t++) {
    e == t ? allSlides[t].classList.remove("slider__item-opacity") : allSlides[t].classList.add("slider__item-opacity");
  }
}

var allTabs = document.querySelectorAll(".product-description__control-block button"),
    charactersBlock = document.querySelector(".characters-block"),
    feedbackBlock = document.querySelector(".feedback"),
    contactBlock = document.querySelector(".contact"),
    arrOfBlocks = [charactersBlock, feedbackBlock, contactBlock];

var _loop2 = function _loop2(_e2) {
  allTabs[_e2].addEventListener("click", function () {
    changeColorButtons(_e2), displaySelectSection(_e2);
  });
};

for (var _e2 = 0; _e2 < allTabs.length; _e2++) {
  _loop2(_e2);
}

function displaySelectSection(e) {
  for (var t = 0; t < arrOfBlocks.length; t++) {
    arrOfBlocks[t].style.display = t == e ? "block" : "none";
  }
}

function changeColorButtons(e) {
  for (var t = 0; t < allTabs.length; t++) {
    t == e ? allTabs[t].classList.add("product-description__btn-active") : allTabs[t].classList.remove("product-description__btn-active");
  }
}

var feedbackOpenBtn = document.querySelector(".feedback__send-btn"),
    modalBackground = document.querySelector(".modal"),
    modalFeedbackWindow = document.querySelector(".feed-window"),
    feedbackSendBtn = document.querySelector(".feed-window__send-btn"),
    feedbackCloseBtn = document.querySelector(".feed-window__close-btn"),
    nameInput = document.querySelector(".feed-window__column-one input");

function displayModalWindow() {
  modalBackground.style.display = "flex", modalBackground.style.animationName = "visible", modalBackground.style.animationPlayState = "running", modalFeedbackWindow.style.display = "flex", modalFeedbackWindow.style.animationName = "visible", modalFeedbackWindow.style.animationPlayState = "running", document.querySelector("body").classList.add("no-scroll"), nameInput.focus();
}

function hideModalWindow() {
  modalBackground.style.animationName = "hidden", setTimeout(function () {
    modalBackground.style.display = "none";
  }, 475), modalFeedbackWindow.style.animationName = "hidden", setTimeout(function () {
    modalFeedbackWindow.style.display = "none";
  }, 475), document.querySelector("body").classList.remove("no-scroll");
}

function checkTarget(e) {
  e.target != modalFeedbackWindow && hideModalWindow();
}

feedbackOpenBtn.addEventListener("click", displayModalWindow), feedbackCloseBtn.addEventListener("click", hideModalWindow), modalBackground.addEventListener("click", checkTarget), document.addEventListener("keydown", function () {
  "Escape" == event.key && hideModalWindow();
});
var localArr = [{
  id: -1,
  name: "Борис Иванов",
  plus: "мощность, внешний вид",
  minus: "Слабые тормозные колодки (пришлось заменить)",
  comment: "Взяли по трейд-ин, на выгодных условиях у дилера. Стильная внешка и крут по базовым характеристикам. Не думал, что пересяду на китайский автопром, но сейчас гоняю и понимаю, что полностью доволен.",
  rate: 4.5
}, {
  id: 0,
  name: "Марсель Исмагилов",
  plus: "Cтиль, комфорт, управляемость",
  minus: "Дорогой ремонт и обслуживание",
  comment: "Дизайн отличный, управление просто шикарно, ощущения за рулём такой машины особые. Но ремонт очень дорогой. Пару месяцев назад пришлось менять двигатель. По стоимости вышло как новый автомобиль. Так что, если покупать эту машину, надо быть готовым к большим расходам на обслуживание.",
  rate: 4.5
}];
var allInputs = document.querySelectorAll(".feed-window__column-one input"),
    feedName = allInputs[0],
    feedPlus = allInputs[1],
    feedMinus = allInputs[2],
    feedComment = document.querySelector(".feed-window__column-two textarea"),
    rateStars = document.querySelectorAll(".feed-window__rate img"),
    feedSendBtn = document.querySelector(".feed-window__send-btn"),
    feedbackMainBlock = document.querySelector(".feedback"),
    feedbackPattern = document.querySelector(".feedback__block");

var _loop3 = function _loop3(_e3) {
  rateStars[_e3].addEventListener("click", function () {
    addStar(event, _e3);
  });
};

for (var _e3 = 0; _e3 < rateStars.length; _e3++) {
  _loop3(_e3);
}

function addStar(e, t) {
  var n = e.target;

  function l(e) {
    "SOURCE" == e.previousSibling.nodeName && e.previousSibling.setAttribute("srcset", "./img/full.webp"), e.setAttribute("src", "./img/full.png"), e.setAttribute("data-rate", "1");
  }

  function i(e) {
    "SOURCE" == e.previousSibling.nodeName && e.previousSibling.setAttribute("srcset", "./img/empty.webp"), e.setAttribute("src", "./img/empty.png"), e.setAttribute("data-rate", "0");
  }

  !function (e) {
    for (var _t = 0; _t < rateStars.length; _t++) {
      _t < e ? l(rateStars[_t]) : _t > e && i(rateStars[_t]);
    }
  }(t), "./img/full.png" == n.getAttribute("src") ? function (e) {
    "SOURCE" == e.previousSibling.nodeName && e.previousSibling.setAttribute("srcset", "./img/half.webp");
    e.setAttribute("src", "./img/half.png"), e.setAttribute("data-rate", "0.5");
  }(n) : l(n);
}

function addDefaultBlockToWeb() {
  for (var _e4 = 0; _e4 < localArr.length; _e4++) {
    createFeedbackBlock(localArr[_e4]);
  }
}

function checkNecessaryInputs() {
  var e,
      t = "1px red solid",
      n = "1px solid rgba(72, 73, 77, 0.2)",
      l = feedName.previousElementSibling,
      i = feedComment.previousElementSibling;

  function a(e, t, n, l) {
    e.style.border = t, n.style.visibility = l;
  }

  return "" == feedName.value && "" == feedComment.value ? (e = !1, a(feedName, t, l, "visible"), a(feedComment, t, i, "visible")) : "" == feedName.value ? (e = !1, a(feedName, t, l, "visible"), a(feedComment, n, i, "hidden")) : "" == feedComment.value ? (e = !1, a(feedComment, t, i, "visible"), a(feedName, n, l, "hidden")) : (e = !0, a(feedName, n, l, "hidden"), a(feedComment, n, i, "hidden")), e;
}

function cleanFormAfterSend() {
  feedName.value = "", feedPlus.value = "", feedMinus.value = "", feedComment.value = "", hideModalWindow();
}

function addDataToStorage() {
  var e = {};
  return e.id = localStorage.length + 1, e.name = feedName.value, e.plus = feedPlus.value, e.minus = feedMinus.value, e.comment = feedComment.value, e.rate = function () {
    var e = 0;

    for (var t = 0; t < rateStars.length; t++) {
      e += Number(rateStars[t].getAttribute("data-rate"));
    }

    return e;
  }(), e;
}

function addDataToLocalStorage() {
  var e = addDataToStorage();
  localStorage.setItem(e.id, JSON.stringify(e));
}

function createFeedbackBlock(e) {
  var t = feedbackPattern.cloneNode(!0),
      n = t.children[0],
      l = t.children[1].children[2],
      i = t.children[2].children[2],
      a = t.children[3].children[1],
      d = t.children[4],
      o = t.children[5].children[1];
  t.classList.remove("feedback__block-hidden"), t.setAttribute("data-id", e.id), n.innerHTML = e.name, l.innerHTML = e.plus, i.innerHTML = e.minus, a.innerHTML = e.comment, d.append(generateRate(e.rate)), o.addEventListener("click", function () {
    expandAnswerBlock(event);
  }), feedbackMainBlock.append(t);
}

function checkId(e) {
  var t = !1;

  for (var n = 3; n < feedbackMainBlock.children.length; n++) {
    null != e.id && feedbackMainBlock.children[n].getAttribute("data-id") == e.id && (t = !0);
  }

  return t;
}

function addNewFeedback() {
  for (var _e5 = 1; _e5 <= localStorage.length; _e5++) {
    var t = JSON.parse(localStorage.getItem(_e5));
    checkId(t) || createFeedbackBlock(t);
  }
}

function generateRate(e) {
  var t = e,
      n = document.createElement("div");

  for (var _e6 = 0; _e6 < 5; _e6++) {
    var _e7 = document.createElement("picture"),
        l = document.createElement("source"),
        i = document.createElement("img");

    l.setAttribute("type", "image/webp"), i.setAttribute("alt", "star"), i.classList.add("feedback__red-star"), t >= 1 ? (l.setAttribute("srcset", "./img/full.webp"), i.setAttribute("src", "./img/full.png"), t -= 1) : .5 == t ? (l.setAttribute("srcset", "./img/half.webp"), i.setAttribute("src", "./img/half.png"), t -= 1) : (l.setAttribute("srcset", "./img/empty.webp"), i.setAttribute("src", "./img/empty.png")), _e7.append(l), _e7.append(i), n.append(_e7);
  }

  return n.append(function (e) {
    var t = document.createElement("span");
    return e > 3 && (t.classList.add("feedback__advice"), t.innerHTML = "Советует"), t;
  }(e)), n;
}

addDefaultBlockToWeb(), addNewFeedback(), feedSendBtn.addEventListener("click", function () {
  checkNecessaryInputs() && (addDataToLocalStorage(), addNewFeedback(), cleanFormAfterSend());
});
var mainAnswerBtn = document.querySelectorAll(".feedback__answer-link"),
    answerBlock = document.querySelectorAll(".feedback__answer"),
    closeAnswerBtn = document.querySelectorAll(".feedback__answer-close-btn"),
    sendAnswerBtn = document.querySelectorAll(".feedback__answer-btn"),
    modarateMessageWindow = document.querySelector(".feedback__modarate-message");

function expandAnswerBlock(e) {
  var t = e.target.parentElement.nextElementSibling,
      n = t.querySelector(".feedback__answer-btn"),
      l = e.target.parentElement.nextElementSibling.children[2],
      i = e.target.parentElement.nextElementSibling.children[1],
      a = e.target.parentElement.nextElementSibling.children[0];
  t.style.animationName = "expandAnswer", t.style.animationPlayState = "running", t.style.display = "block", a.style.border = "1px solid black", l.addEventListener("click", function () {
    hideAnswerBlock(e);
  }), i.addEventListener("click", function () {
    checkAnswer(e);
  }), setTimeout(function () {
    n.style.visibility = "visible";
  }, 800);
}

function hideAnswerBlock(e, t) {
  var n = e.target.parentElement.nextElementSibling,
      l = n.querySelector(".feedback__answer-btn");
  n.style.animationName = "hideAnswer", n.style.animationPlayState = "running", l.style.visibility = "hidden", setTimeout(function () {
    n.style.display = "none";
  }, 900);
}

function checkAnswer(e) {
  var t = e.target.parentElement.nextElementSibling.children[0];
  "" == t.value ? t.style.border = "2px solid red" : (t.style.border = "1px solid black", t.value = "", hideAnswerBlock(e), getModerateMessage());
}

function getModerateMessage() {
  modarateMessageWindow.style.display = "flex", setTimeout(function () {
    modarateMessageWindow.style.display = "none";
  }, 3e3);
}

function initMap() {
  var e = {
    lat: 59.968368,
    lng: 30.317514
  },
      t = new google.maps.Map(document.querySelector(".contact__map"), {
    zoom: 15,
    center: e
  });
  new google.maps.Marker({
    position: e,
    map: t
  });
}